<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>constriction API documentation</title>
<meta name="description" content="Entropy Coding Primitives for Research and Production â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>constriction</code></h1>
</header>
<section id="section-intro">
<h2 id="entropy-coding-primitives-for-research-and-production">Entropy Coding Primitives for Research and Production</h2>
<p>The <code><a title="constriction" href="#constriction">constriction</a></code> library provides a set of composable entropy coding algorithms with a
focus on correctness, versatility, ease of use, compression performance, and
computational efficiency. The goals of <code><a title="constriction" href="#constriction">constriction</a></code> are to three-fold:</p>
<ol>
<li><strong>to facilitate research on novel lossless and lossy compression methods</strong> by
providing a <em>composable</em> set of entropy coding primitives rather than a rigid
implementation of a single preconfigured method;</li>
<li><strong>to simplify the transition from research code to production software</strong> by exposing
the exact same functionality via both a Python API (for rapid prototyping on research
code) and a Rust API (for turning successful prototypes into production); and</li>
<li><strong>to serve as a teaching resource</strong> by providing a wide range of entropy coding
algorithms within a single consistent framework, thus making the various algorithms
easily discoverable and comparable on example models and data. <a href="https://robamler.github.io/teaching/compress21/">Additional teaching
material</a> is being made publicly
available as a by-product of an ongoing university course on data compression with
deep probabilistic models.</li>
</ol>
<p>For an example of a compression codec that started as research code in Python and was
then deployed as a fast and dependency-free WebAssembly module using <code><a title="constriction" href="#constriction">constriction</a></code>'s
Rust API, have a look at <a href="https://robamler.github.io/linguistic-flux-capacitor">The Linguistic Flux
Capacitor</a>.</p>
<h2 id="project-status">Project Status</h2>
<p>We currently provide implementations of the following entropy coding algorithms:</p>
<ul>
<li><strong>Asymmetric Numeral Systems (ANS):</strong> a fast modern entropy coder with near-optimal
compression effectiveness that supports advanced use cases like bits-back coding.</li>
<li><strong>Range Coding:</strong> a computationally efficient variant of Arithmetic Coding, that has
essentially the same compression effectiveness as ANS Coding but operates as a queue
("first in first out"), which makes it preferable for autoregressive models.</li>
<li><strong>Chain Coding:</strong> an experimental new entropy coder that combines the (net)
effectiveness of stream codes with the locality of symbol codes; it is meant for
experimental new compression approaches that perform joint inference, quantization,
and bits-back coding in an end-to-end optimization. This experimental coder is mainly
provided to prove to ourselves that the API for encoding and decoding, which is shared
across all stream coders, is flexible enough to express complex novel tasks.</li>
<li><strong>Huffman Coding:</strong> a well-known symbol code, mainly provided here for teaching
purpose; you'll usually want to use a stream code like ANS or Range Coding instead
since symbol codes can have a considerable overhead on the bitrate, especially in the
regime of low entropy per symbol, which is common in machine-learning based
compression methods.</li>
</ul>
<p>Further, <code><a title="constriction" href="#constriction">constriction</a></code> provides implementations of common probability distributions in
fixed-point arithmetic, which can be used as entropy models in either of the above
stream codes. The library also provides adapters for turning custom probability
distributions into exactly invertible fixed-point arithmetic.</p>
<p>The provided implementations of entropy coding algorithms and probability distributions
are extensively tested and should be considered reliable (except for the still
experimental Chain Coder). However, their APIs may change in future versions of
<code><a title="constriction" href="#constriction">constriction</a></code> if more user experience reveals any shortcomings of the current APIs in
terms of ergonomics. Please <a href="https://github.com/bamler-lab/constriction/issues">file an
issue</a> if you run into a scenario
where the current APIs are suboptimal.</p>
<h2 id="quick-start-with-the-python-api">Quick Start With the Python API</h2>
<p>You are currently reading the documentation of <code><a title="constriction" href="#constriction">constriction</a></code>'s Python API. If Python is
not your language of choice then head over to the <a href="https://docs.rs/constriction">Rust API
Documentation</a>. The Python API focuses on ease of use and
rapid iteration and is targeted mainly towards data scientists and machine learning
researchers. The Rust API provides binary identical implementations of everything that's
available through the Python API. Additionally, the Rust API, provides optional finer
grained control over technical details (such as word size or numerical precision) using
Rust's generic type system.</p>
<h3 id="installation">Installation</h3>
<p>The easiest and recommended way to install <code><a title="constriction" href="#constriction">constriction</a></code> for Python is via <code>pip</code>:</p>
<pre><code class="language-bash">pip install constriction numpy
</code></pre>
<h3 id="example">Example</h3>
<p>Let's encode a sequence of symbols and write the compressed data to a binary file. We'll
use a quantized Gaussian distribution as entropy model, with a different mean and
standard deviation of the Gaussian for each symbol so that the example is not too
simplistic. Further, we'll use an Asymmetric Numeral Systems (ANS) Coder here for its
speed and compression performance. We'll discuss how you could replace the ANS Coder
with a Range Coder or a symbol code like Huffman Coding <a href="#exercise">below</a>.</p>
<pre><code class="language-python">import constriction
import numpy as np
import sys

# Create an empty Asymmetric Numeral Systems (ANS) Coder:
coder = constriction.stream.stack.AnsCoder()

# Some made up data and entropy models for demonstration purpose:
min_supported_symbol, max_supported_symbol = -100, 100  # both inclusively
symbols = np.array([23, -15, 78, 43, -69], dtype=np.int32)
means = np.array([35.2, -1.7, 30.1, 71.2, -75.1], dtype=np.float64)
stds = np.array([10.1, 25.3, 23.8, 35.4, 3.9], dtype=np.float64)

# Encode the data (in reverse order, since ANS is a stack):
coder.encode_leaky_gaussian_symbols_reverse(
    symbols, min_supported_symbol, max_supported_symbol, means, stds)

print(f&quot;Compressed size: {coder.num_bits()} bits&quot;)
print(f&quot;(without unnecessary trailing zeros: {coder.num_valid_bits()} bits)&quot;)

# Get the compressed bit string, convert it into an architecture-independent
# byte order, and write it to a binary file:
compressed = coder.get_compressed()
if sys.byteorder == &quot;big&quot;:
    compressed.byteswap(inplace=True)
compressed.tofile(&quot;compressed.bin&quot;)
</code></pre>
<p>Now let's read the compressed bit string back in and decode it.</p>
<pre><code class="language-python">import constriction
import numpy as np
import sys

# Read the compressed bit string from the file we created above and convert
# it into the right byte order for the current computer architecture:
compressed = np.fromfile(&quot;compressed.bin&quot;, dtype=np.uint32)
if sys.byteorder == &quot;big&quot;:
    compressed.byteswap(inplace=True)

# Initialize an ANS coder from the compressed bit string:
coder = constriction.stream.stack.AnsCoder(compressed)

# Use the same entropy models that we used for encoding:
min_supported_symbol, max_supported_symbol = -100, 100  # both inclusively
means = np.array([35.2, -1.7, 30.1, 71.2, -75.1], dtype=np.float64)
stds = np.array([10.1, 25.3, 23.8, 35.4, 3.9], dtype=np.float64)

# Decode and print the data:
reconstructed = coder.decode_leaky_gaussian_symbols(
    min_supported_symbol, max_supported_symbol, means, stds)
assert coder.is_empty()
print(reconstructed)  # Should print [23, -15, 78, 43, -69].
</code></pre>
<h3 id="exercise">Exercise</h3>
<p>Try out the above example and verify that decoding reconstructs the original data. Then
see how easy <code><a title="constriction" href="#constriction">constriction</a></code> makes it to replace the ANS coder with a range coder by
making the following substitutions:</p>
<p><strong>In the encoder,</strong></p>
<ul>
<li>replace <code>constriction.stream.stack.AnsCoder</code> with
<code>constriction.stream.queue.RangeEncoder</code>; and</li>
<li>replace <code>coder.encode_leaky_gaussian_symbols_reverse</code> with
<code>coder.encode_leaky_gaussian_symbols</code> (we no longer need to encode symbols in reverse
order since Range Coding is a queue, i.e., first-in-first-out; we only had to reverse
the order for the ANS coder since ANS is a stack, i.e., last-in-first-out).</li>
</ul>
<p><strong>In the decoder,</strong></p>
<ul>
<li>replace <code>constriction.stream.stack.AnsCoder</code> with
<code>constriction.stream.queue.RangeDecoder</code> (note that Range Coding distinguishes between
an encoder and a decoder type since the encoder writes to the back while the decoder
reads from the front; by contrast, ANS Coding is a stack, i.e., it reads and writes at
the same position and allows interleaving reads and writes).</li>
</ul>
<p>You could also use a symbol code like Huffman Coding (see submodule <code><a title="constriction.symbol" href="symbol.html">constriction.symbol</a></code>) but that
would have considerably worse compression performance, especially on large files, since
symbol codes always emit an integer number of bits per compressed symbol, even if the
information content of the symbol is a fractional number (stream codes like ANS and
Range Coding <em>effectively</em> emit a fractional number of bits per symbol since they
amortize over several symbols).</p>
<p>The above replacements should lead you to something like the following:</p>
<pre><code class="language-python">import constriction
import numpy as np
import sys

# Create an empty Range Encoder:
encoder = constriction.stream.queue.RangeEncoder()

# Same made up data and entropy models as in the ANS Coding example above:
min_supported_symbol, max_supported_symbol = -100, 100  # both inclusively
symbols = np.array([23, -15, 78, 43, -69], dtype=np.int32)
means = np.array([35.2, -1.7, 30.1, 71.2, -75.1], dtype=np.float64)
stds = np.array([10.1, 25.3, 23.8, 35.4, 3.9], dtype=np.float64)

# Encode the data (this time in normal order, since Range Coding is a queue):
encoder.encode_leaky_gaussian_symbols(
    symbols, min_supported_symbol, max_supported_symbol, means, stds)

print(f&quot;Compressed size: {encoder.num_bits()} bits&quot;)

# Get the compressed bit string (sealed up to full words):
compressed = encoder.get_compressed()

# ... writing and reading from file same as above (skipped here) ...

# Initialize a Range Decoder from the compressed bit string:
decoder = constriction.stream.queue.RangeDecoder(compressed)

# Decode the data and verify it's correct:
reconstructed = decoder.decode_leaky_gaussian_symbols(
    min_supported_symbol, max_supported_symbol, means, stds)
assert decoder.maybe_exhausted()
assert np.all(reconstructed == symbols)
</code></pre>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from .constriction import *

__doc__ = constriction.__doc__</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="constriction.stream" href="stream.html">constriction.stream</a></code></dt>
<dd>
<div class="desc"><p>Stream codes, i.e., entropy codes that amortize compressed bits over several symbols.</p></div>
</dd>
<dt><code class="name"><a title="constriction.symbol" href="symbol.html">constriction.symbol</a></code></dt>
<dd>
<div class="desc"><p>Symbol codes. Mainly provided for teaching purpose. You probably want to use a <a href="stream.html">stream
code</a> instead.</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#entropy-coding-primitives-for-research-and-production">Entropy Coding Primitives for Research and Production</a></li>
<li><a href="#project-status">Project Status</a></li>
<li><a href="#quick-start-with-the-python-api">Quick Start With the Python API</a><ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#example">Example</a></li>
<li><a href="#exercise">Exercise</a></li>
</ul>
</li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="constriction.stream" href="stream.html">constriction.stream</a></code></li>
<li><code><a title="constriction.symbol" href="symbol.html">constriction.symbol</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>