<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.1">
<title>constriction.symbol API documentation</title>
<meta name="description" content="Symbol codes. Mainly provided for teaching purpose. You&#39;ll probably want to use a
[stream code](stream.html) instead …">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>constriction.symbol</code></h1>
</header>
<section id="section-intro">
<p>Symbol codes. Mainly provided for teaching purpose. You'll probably want to use a
<a href="stream.html">stream code</a> instead.</p>
<p>Symbol codes encode messages (= sequences of symbols) by compressing each symbol
individually and then concatenating the compressed representations of the symbols
(called code words). This has the advantage of being conceptually simple, but the
disadvantage of incurring an overhead of up to almost 1 bit <em>per symbol</em>. The overhead
is most significant in the regime of low entropy per symbol (often the regime of novel
machine-learning based compression methods), since each (nontrivial) symbol in a symbol
code contributes at least 1 bit to the total bitrate of the message, even if its
information content is only marginally above zero.</p>
<p>This module defines the types <code><a title="constriction.symbol.QueueEncoder" href="#constriction.symbol.QueueEncoder">QueueEncoder</a></code>, <code><a title="constriction.symbol.QueueDecoder" href="#constriction.symbol.QueueDecoder">QueueDecoder</a></code>, and <code><a title="constriction.symbol.StackCoder" href="#constriction.symbol.StackCoder">StackCoder</a></code>, which
are essentially just efficient containers for of growable bit strings. The interesting
part happens in the so-called code book, which defines how symbols map to code words. We
provide the Huffman Coding algorithm in the submodule <a href="symbol/huffman.html"><code>huffman</code></a>,
which calculates an optimal code book for a given probability distribution.</p>
<h2 id="examples">Examples</h2>
<p>The following two examples both encode and then decode a sequence of symbols using the
same entropy model for each symbol. We could as well use a different entropy model for
each symbol, but it would make the examples more lengthy.</p>
<ul>
<li>Example 1: Encoding and decoding with "queue" semantics ("first in first out", i.e.,
we'll decode symbols in the same order in which we encode them):</li>
</ul>
<pre><code class="language-python">import constriction
import numpy as np

# Define an entropy model over the (implied) alphabet {0, 1, 2, 3}:
probabils = np.array([0.3, 0.2, 0.4, 0.1], dtype=np.float32)

# Encode some example message, using the same model for each symbol here:
message = [1, 3, 2, 3, 0, 1, 3, 0, 2, 1, 1, 3, 3, 1, 2, 0, 1, 3, 1]
encoder = constriction.symbol.QueueEncoder()
encoder_codebook = constriction.symbol.huffman.EncoderHuffmanTree(probabils)
for symbol in message:
    encoder.encode_symbol(symbol, encoder_codebook)

# Obtain the compressed representation and the bitrate:
compressed, bitrate = encoder.get_compressed()
print(compressed, bitrate) # (prints: [3756389791, 61358], 48)
print(f&quot;(in binary: {[bin(word) for word in compressed]}&quot;)

# Decode the message
decoder = constriction.symbol.QueueDecoder(compressed)
decoded = []
decoder_codebook = constriction.symbol.huffman.DecoderHuffmanTree(probabils)
for symbol in range(19):
    decoded.append(decoder.decode_symbol(decoder_codebook))

assert decoded == message # (verifies correctness)
</code></pre>
<ul>
<li>Example 2: Encoding and decoding with "stack" semantics ("last in first out", i.e.,
we'll encode symbols from back to front and then decode them from front to back):</li>
</ul>
<pre><code class="language-python">import constriction
import numpy as np

# Define an entropy model over the (implied) alphabet {0, 1, 2, 3}:
probabils = np.array([0.3, 0.2, 0.4, 0.1], dtype=np.float32)

# Encode some example message, using the same model for each symbol here:
message = [1, 3, 2, 3, 0, 1, 3, 0, 2, 1, 1, 3, 3, 1, 2, 0, 1, 3, 1]
coder = constriction.symbol.StackCoder()
encoder_codebook = constriction.symbol.huffman.EncoderHuffmanTree(probabils)
for symbol in reversed(message): # Note: reversed
    coder.encode_symbol(symbol, encoder_codebook)

# Obtain the compressed representation and the bitrate:
compressed, bitrate = coder.get_compressed()
print(compressed, bitrate) # (prints: [[2818274807, 129455] 48)
print(f&quot;(in binary: {[bin(word) for word in compressed]}&quot;)

# Decode the message (we could explicitly construct a decoder:
# `decoder = constriction.symbol.StackCoder(compressed)`
# but we can also also reuse our existing `coder` for decoding):
decoded = []
decoder_codebook = constriction.symbol.huffman.DecoderHuffmanTree(probabils)
for symbol in range(19):
    decoded.append(coder.decode_symbol(decoder_codebook))

assert decoded == message # (verifies correctness)
</code></pre>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="constriction.symbol.huffman" href="symbol/huffman.html">constriction.symbol.huffman</a></code></dt>
<dd>
<div class="desc"><p>Codebooks for Huffman coding [1] …</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="constriction.symbol.QueueDecoder"><code class="flex name class">
<span>class <span class="ident">QueueDecoder</span></span>
<span>(</span><span>compressed)</span>
</code></dt>
<dd>
<div class="desc"><p>A container of compressed bits that can be read from front to back for decoding.</p>
<p>This is the counterpart to <code><a title="constriction.symbol.QueueEncoder" href="#constriction.symbol.QueueEncoder">QueueEncoder</a></code>. The constructor takes a single argument,
which must be a rank-1 numpy array with <code>dtype=np.uint32</code>, as in the first return value
of
is returned by `QueueEncoder.get_compressed()</p>
<h2 id="example">Example:</h2>
<p>See first <a href="#examples">module level example</a>.</p></div>
<h3>Methods</h3>
<dl>
<dt id="constriction.symbol.QueueDecoder.decode_symbol"><code class="name flex">
<span>def <span class="ident">decode_symbol</span></span>(<span>self, /, codebook)</span>
</code></dt>
<dd>
<div class="desc"><p>Reads more bits from the current encapsulated compressed data and tries to match
them up with one of the code words in the provided code book, returning the
corresponding symbol on success.</p>
<h2 id="arguments">Arguments</h2>
<ul>
<li><strong>codebook</strong> &mdash; a decoder code book for a symbol code. Currently,
<a href="symbol/huffman.html#constriction.symbol.huffman.DecoderHuffmanTree"><code>DecoderHuffmanTree</code></a>
is the only implemented decoder code book.</li>
</ul></div>
</dd>
</dl>
</dd>
<dt id="constriction.symbol.QueueEncoder"><code class="flex name class">
<span>class <span class="ident">QueueEncoder</span></span>
</code></dt>
<dd>
<div class="desc"></div>
<h3>Methods</h3>
<dl>
<dt id="constriction.symbol.QueueEncoder.encode_symbol"><code class="name flex">
<span>def <span class="ident">encode_symbol</span></span>(<span>self, /, symbol, codebook)</span>
</code></dt>
<dd>
<div class="desc"><p>Looks up the provided symbol in the provided codebook and appends its bits to the
compressed data such that they form a prefix-free code (i.e., a code that can easily
be read from front to back).</p>
<h2 id="arguments">Arguments</h2>
<ul>
<li><strong>symbol</strong> &mdash; an integer in the range <code>{0, 1, ..., n-1}</code> where <code>n</code> is the size of
the <code>codebook</code> provided in the second argument.</li>
<li><strong>codebook</strong> &mdash; an encoder code book for a symbol code. Currently,
<a href="symbol/huffman.html#constriction.symbol.huffman.EncoderHuffmanTree"><code>EncoderHuffmanTree</code></a>
is the only implemented encoder code book.</li>
</ul></div>
</dd>
<dt id="constriction.symbol.QueueEncoder.get_compressed"><code class="name flex">
<span>def <span class="ident">get_compressed</span></span>(<span>self, /)</span>
</code></dt>
<dd>
<div class="desc"><p>Deprecated method. Please use <code>get_compressed_and_bitrate</code> instead.</p>
<p>(The method was renamed to <code>get_compressed_and_bitrate</code> in <code><a title="constriction" href="index.html">constriction</a></code> version
0.4.0 to avoid confusion about the return type.)</p></div>
</dd>
<dt id="constriction.symbol.QueueEncoder.get_compressed_and_bitrate"><code class="name flex">
<span>def <span class="ident">get_compressed_and_bitrate</span></span>(<span>self, /)</span>
</code></dt>
<dd>
<div class="desc"><p>Returns a tuple <code>(compressed, bitrate)</code>, where <code>compressed</code> is a copy of the
compressed representation that is currently on the coder (filled with zero bits to a
multiple of 32 bits), and <code>bitrate</code> is the number of information-carrying bits.</p>
<p>You can write the compressed data to a file (by calling
<code>compressed.tofile("filename")</code>), read it back in at a later point (with
<code>compressed = np.fromfile("filename")</code>) and then construct a <code><a title="constriction.symbol.QueueDecoder" href="#constriction.symbol.QueueDecoder">QueueDecoder</a></code> from.</p></div>
</dd>
<dt id="constriction.symbol.QueueEncoder.get_decoder"><code class="name flex">
<span>def <span class="ident">get_decoder</span></span>(<span>self, /)</span>
</code></dt>
<dd>
<div class="desc"><p>Shortcut for <code><a title="constriction.symbol.QueueDecoder" href="#constriction.symbol.QueueDecoder">QueueDecoder</a>(encoder.get_compressed())</code> where <code>encoder</code> is a
<code><a title="constriction.symbol.QueueEncoder" href="#constriction.symbol.QueueEncoder">QueueEncoder</a></code>.</p>
<p>Copies the compressed data out of the encoder. Thus, if you continue to encode
symbols on the encoder, those won't affect what you will be able to decode on the
decoder.</p></div>
</dd>
</dl>
</dd>
<dt id="constriction.symbol.StackCoder"><code class="flex name class">
<span>class <span class="ident">StackCoder</span></span>
<span>(</span><span>compressed=None)</span>
</code></dt>
<dd>
<div class="desc"><p>A container of compressed bits that allows appending and consuming bits from the same
end.</p>
<p>When encoding onto a <code><a title="constriction.symbol.StackCoder" href="#constriction.symbol.StackCoder">StackCoder</a></code>, the bits that comprise each code word are
automatically appended in reverse order so that a prefix-free code becomes a suffix-free
code which can easily be decoded from the end. For Huffman Coding, this is actually the
natural way to generate code words (by walking the tree from a leaf to the root).</p>
<p>A <code><a title="constriction.symbol.StackCoder" href="#constriction.symbol.StackCoder">StackCoder</a></code> does not distinguish between an encoder and a decoder. It supports both
encoding and decoding with a single data structure and even allows you to arbitrarily
switch back and forth between encoding and decoding operations (e.g., for bits-back
coding).</p>
<p>The constructor takes existing compressed data as an optional argument. If it is
provided, it must must be a rank-1 numpy array with, as in the first return value of the
method <code>get_compressed</code>. If no argument is provided, then the <code><a title="constriction.symbol.StackCoder" href="#constriction.symbol.StackCoder">StackCoder</a></code> is
initialized empty (useful for encoding).</p>
<h2 id="example">Example:</h2>
<p>See second <a href="#examples">module level example</a>.</p></div>
<h3>Methods</h3>
<dl>
<dt id="constriction.symbol.StackCoder.decode_symbol"><code class="name flex">
<span>def <span class="ident">decode_symbol</span></span>(<span>self, /, codebook)</span>
</code></dt>
<dd>
<div class="desc"><p>Consumes bits from the end of the encapsulated compressed data and tries to match
them up with one of the code words in the provided code book, returning the
corresponding symbol on success.</p>
<h2 id="arguments">Arguments</h2>
<ul>
<li><strong>codebook</strong> &mdash; a decoder code book for a symbol code. Currently,
<a href="symbol/huffman.html#constriction.symbol.huffman.DecoderHuffmanTree"><code>DecoderHuffmanTree</code></a>
is the only implemented decoder code book.</li>
</ul></div>
</dd>
<dt id="constriction.symbol.StackCoder.encode_symbol"><code class="name flex">
<span>def <span class="ident">encode_symbol</span></span>(<span>self, /, symbol, codebook)</span>
</code></dt>
<dd>
<div class="desc"><p>Looks up the provided symbol in the provided codebook and appends its bits to the
compressed data such that they form a suffix-free code (i.e., a code that can easily
be read from back to front).</p>
<h2 id="arguments">Arguments</h2>
<ul>
<li><strong>symbol</strong> &mdash; an integer in the range <code>{0, 1, ..., n-1}</code> where <code>n</code> is the size of
the <code>codebook</code> provided in the second argument.</li>
<li><strong>codebook</strong> &mdash; an encoder code book for a symbol code. Currently,
<a href="symbol/huffman.html#constriction.symbol.huffman.EncoderHuffmanTree"><code>EncoderHuffmanTree</code></a>
is the only implemented encoder code book.</li>
</ul></div>
</dd>
<dt id="constriction.symbol.StackCoder.get_compressed"><code class="name flex">
<span>def <span class="ident">get_compressed</span></span>(<span>self, /)</span>
</code></dt>
<dd>
<div class="desc"><p>Deprecated method. Please use <code>get_compressed_and_bitrate</code> instead.</p>
<p>(The method was renamed to <code>get_compressed_and_bitrate</code> in <code><a title="constriction" href="index.html">constriction</a></code> version
0.4.0 to avoid confusion about the return type.)</p></div>
</dd>
<dt id="constriction.symbol.StackCoder.get_compressed_and_bitrate"><code class="name flex">
<span>def <span class="ident">get_compressed_and_bitrate</span></span>(<span>self, /)</span>
</code></dt>
<dd>
<div class="desc"><p>Returns a tuple <code>(compressed, bitrate)</code>, where <code>compressed</code> is a copy of the
compressed representation that is currently on the coder (filled with zero bits to a
multiple of 32 bits), and <code>bitrate</code> is the number of information-carrying bits.</p>
<p>You can write the compressed data to a file (by calling
<code>compressed.tofile("filename")</code>), read it back in at a later point (with
<code>compressed = np.fromfile("filename")</code>) and then reconstruct a coder (for decoding)
py passing <code>compressed</code> to the constructor of <code><a title="constriction.symbol.StackCoder" href="#constriction.symbol.StackCoder">StackCoder</a></code>.</p></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul>
<li><a href="#examples">Examples</a></li>
</ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="constriction" href="index.html">constriction</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="constriction.symbol.huffman" href="symbol/huffman.html">constriction.symbol.huffman</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="constriction.symbol.QueueDecoder" href="#constriction.symbol.QueueDecoder">QueueDecoder</a></code></h4>
<ul class="">
<li><code><a title="constriction.symbol.QueueDecoder.decode_symbol" href="#constriction.symbol.QueueDecoder.decode_symbol">decode_symbol</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="constriction.symbol.QueueEncoder" href="#constriction.symbol.QueueEncoder">QueueEncoder</a></code></h4>
<ul class="">
<li><code><a title="constriction.symbol.QueueEncoder.encode_symbol" href="#constriction.symbol.QueueEncoder.encode_symbol">encode_symbol</a></code></li>
<li><code><a title="constriction.symbol.QueueEncoder.get_compressed" href="#constriction.symbol.QueueEncoder.get_compressed">get_compressed</a></code></li>
<li><code><a title="constriction.symbol.QueueEncoder.get_compressed_and_bitrate" href="#constriction.symbol.QueueEncoder.get_compressed_and_bitrate">get_compressed_and_bitrate</a></code></li>
<li><code><a title="constriction.symbol.QueueEncoder.get_decoder" href="#constriction.symbol.QueueEncoder.get_decoder">get_decoder</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="constriction.symbol.StackCoder" href="#constriction.symbol.StackCoder">StackCoder</a></code></h4>
<ul class="">
<li><code><a title="constriction.symbol.StackCoder.decode_symbol" href="#constriction.symbol.StackCoder.decode_symbol">decode_symbol</a></code></li>
<li><code><a title="constriction.symbol.StackCoder.encode_symbol" href="#constriction.symbol.StackCoder.encode_symbol">encode_symbol</a></code></li>
<li><code><a title="constriction.symbol.StackCoder.get_compressed" href="#constriction.symbol.StackCoder.get_compressed">get_compressed</a></code></li>
<li><code><a title="constriction.symbol.StackCoder.get_compressed_and_bitrate" href="#constriction.symbol.StackCoder.get_compressed_and_bitrate">get_compressed_and_bitrate</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.1</a>.</p>
</footer>
</body>
</html>
